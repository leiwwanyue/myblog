(function(){"use strict";var e={9979:function(e,t,n){var o=n(5130),i=n(6768);function r(e,t,n,o,r,s){const c=(0,i.g2)("LoginWithSMS");return(0,i.uX)(),(0,i.Wv)(c)}var s=n(4232);const c=e=>((0,i.Qi)("data-v-5e7c973d"),e=e(),(0,i.jt)(),e),a={class:"login-container"},u={class:"input-group"},d=["value"],l={class:"input-group"},f=c((()=>(0,i.Lk)("label",{for:"verification_code",style:{float:"top"}},"验证码",-1))),h=["disabled"],p=c((()=>(0,i.Lk)("button",{type:"submit"},"登录",-1))),m={key:0,class:"message"};function v(e,t,n,r,c,v){return(0,i.uX)(),(0,i.CE)("div",a,[(0,i.Lk)("form",{onSubmit:t[4]||(t[4]=(0,o.D$)(((...e)=>v.submitLogin&&v.submitLogin(...e)),["prevent"]))},[(0,i.Lk)("div",u,[(0,i.bo)((0,i.Lk)("select",{id:"country_code","onUpdate:modelValue":t[0]||(t[0]=e=>c.countryCode=e)},[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(c.countryCodes,(e=>((0,i.uX)(),(0,i.CE)("option",{key:e.code,value:e.code},(0,s.v_)(e.name)+" ("+(0,s.v_)(e.code)+") ",9,d)))),128))],512),[[o.u1,c.countryCode]]),(0,i.bo)((0,i.Lk)("input",{type:"text",id:"phone_number","onUpdate:modelValue":t[1]||(t[1]=e=>c.phoneNumber=e),placeholder:"请输入手机号",required:""},null,512),[[o.Jo,c.phoneNumber]])]),(0,i.Lk)("div",l,[f,(0,i.bo)((0,i.Lk)("input",{type:"text",class:"verification_code",id:"verification_code","onUpdate:modelValue":t[2]||(t[2]=e=>c.verificationCode=e),style:{width:"calc(100%)",float:"top"},required:""},null,512),[[o.Jo,c.verificationCode]]),(0,i.Lk)("button",{type:"button",class:"verification_code_button",onClick:t[3]||(t[3]=(...e)=>v.requestVerificationCode&&v.requestVerificationCode(...e)),disabled:c.isSendingCode,style:{float:"bottom"}},(0,s.v_)(v.buttonText),9,h)]),p],32),c.message?((0,i.uX)(),(0,i.CE)("div",m,(0,s.v_)(c.message),1)):(0,i.Q3)("",!0)])}var b=n(4373);const g=[{name:"中国",code:"+86"},{name:"美国",code:"+1"},{name:"加拿大",code:"+1"},{name:"英国",code:"+44"},{name:"法国",code:"+33"},{name:"德国",code:"+49"},{name:"日本",code:"+81"},{name:"韩国",code:"+82"},{name:"澳大利亚",code:"+61"},{name:"新加坡",code:"+65"}];var y={data(){return{countryCodes:g,countryCode:"+86",phoneNumber:"",verificationCode:"",isSendingCode:!1,countdown:60,message:""}},computed:{buttonText(){return this.isSendingCode?`${this.countdown} 秒后重新获取`:"获取验证码"}},methods:{async requestVerificationCode(){if(!this.phoneNumber)return this.message="请填写手机号",void console.error(this.message);this.isSendingCode=!0;try{const e=document.querySelector("[name=csrfmiddlewaretoken]").value,t=await b.A.post("http://127.0.0.1:8000/api/request_verification_code/",{country_code:this.countryCode,phone_number:this.phoneNumber},{headers:{"Content-Type":"application/json","X-CSRFToken":e}});t.data.success?(this.isSendingCode=!0,this.message="验证码已发送",this.startCountdown()):(this.message="发送验证码失败",this.isSendingCode=!1)}catch(e){console.error(e),this.message="发送验证码失败",this.isSendingCode=!1}},async submitLogin(){if(!this.phoneNumber||!this.verificationCode)return this.message="请填写完整信息",void(this.isSendingCode=!1);try{const e=document.querySelector("[name=csrfmiddlewaretoken]").value,t=await b.A.post("http://127.0.0.1:8000/api/login_with_verification_code/",{country_code:this.countryCode,phone_number:this.phoneNumber,verification_code:this.verificationCode},{headers:{"Content-Type":"application/json","X-CSRFToken":e}});t.data.success&&(this.message="登录成功",t.data.redirect_url?window.location.href=t.data.redirect_url:(this.message="验证码错误或登录失败",this.isSendingCode=!1))}catch(e){console.error(e),this.message="登录失败",this.isSendingCode=!1}},startCountdown(){const e=setInterval((()=>{this.countdown>0?this.countdown--:(clearInterval(e),this.countdownTimer=null,this.isSendingCode=!1,this.countdown=60)}),1e3)}}},C=n(1241);const _=(0,C.A)(y,[["render",v],["__scopeId","data-v-5e7c973d"]]);var S=_,w={name:"App",components:{LoginWithSMS:S}};const k=(0,C.A)(w,[["render",r]]);var L=k;b.A.defaults.baseURL="http://localhost:8080",(0,o.Ef)(L).component("LoginWithSMS",S).mount("#app")}},t={};function n(o){var i=t[o];if(void 0!==i)return i.exports;var r=t[o]={exports:{}};return e[o].call(r.exports,r,r.exports,n),r.exports}n.m=e,function(){var e=[];n.O=function(t,o,i,r){if(!o){var s=1/0;for(d=0;d<e.length;d++){o=e[d][0],i=e[d][1],r=e[d][2];for(var c=!0,a=0;a<o.length;a++)(!1&r||s>=r)&&Object.keys(n.O).every((function(e){return n.O[e](o[a])}))?o.splice(a--,1):(c=!1,r<s&&(s=r));if(c){e.splice(d--,1);var u=i();void 0!==u&&(t=u)}}return t}r=r||0;for(var d=e.length;d>0&&e[d-1][2]>r;d--)e[d]=e[d-1];e[d]=[o,i,r]}}(),function(){n.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return n.d(t,{a:t}),t}}(),function(){n.d=function(e,t){for(var o in t)n.o(t,o)&&!n.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})}}(),function(){n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){n.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){var e={524:0};n.O.j=function(t){return 0===e[t]};var t=function(t,o){var i,r,s=o[0],c=o[1],a=o[2],u=0;if(s.some((function(t){return 0!==e[t]}))){for(i in c)n.o(c,i)&&(n.m[i]=c[i]);if(a)var d=a(n)}for(t&&t(o);u<s.length;u++)r=s[u],n.o(e,r)&&e[r]&&e[r][0](),e[r]=0;return n.O(d)},o=self["webpackChunkfrontend"]=self["webpackChunkfrontend"]||[];o.forEach(t.bind(null,0)),o.push=t.bind(null,o.push.bind(o))}();var o=n.O(void 0,[504],(function(){return n(9979)}));o=n.O(o)})();
//# sourceMappingURL=app.37a9fb43.js.map